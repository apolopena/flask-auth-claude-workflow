{% extends "base.html" %}

{% block title %}Forgot Password - Flask Auth{% endblock %}

{% block content %}
<article>
    <h1>Forgot Password</h1>
    <p>Enter your email address and we'll send you a password reset link</p>

    <form id="forgot-password-form">
        <div class="form-group">
            <label for="email">Email Address</label>
            <input
                type="email"
                id="email"
                name="email"
                placeholder="you@example.com"
                required
                autocomplete="email"
            >
        </div>

        <button type="submit" id="submit-btn">Send Reset Link</button>
    </form>

    <div id="success-message" style="display: none;" class="message success">
        <strong>Check your email!</strong>
        <p>If an account exists with this email, you will receive a password reset link shortly.</p>
        <p>The link will expire in 1 hour.</p>
    </div>

    <p class="text-center mt-2">
        Remember your password?
        <a href="{{ url_for('frontend.login_page') }}" class="text-link">Login here</a>
    </p>
</article>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('forgot-password-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('submit-btn');
        const email = document.getElementById('email').value.trim();
        const successMessage = document.getElementById('success-message');
        const form = document.getElementById('forgot-password-form');

        // Client-side validation
        if (!email) {
            showMessage('Please enter your email address', 'error');
            return;
        }

        // Set loading state
        setButtonLoading(submitBtn, true);

        try {
            const response = await apiCall('/auth/forgot-password', {
                method: 'POST',
                body: JSON.stringify({ email })
            });

            const data = await response.json();

            if (response.ok) {
                // Always show success message (security: don't reveal if email exists)
                form.style.display = 'none';
                successMessage.style.display = 'block';
            } else {
                // Show error message from API
                showMessage(data.error || 'Request failed', 'error');
            }
        } catch (error) {
            showMessage('Network error. Please try again.', 'error');
            console.error('Forgot password error:', error);
        } finally {
            setButtonLoading(submitBtn, false);
        }
    });
</script>
{% endblock %}
